// protoc --go_out=internal/infrastructure/client/roadmapclient/. --go-grpc_out=internal/infrastructure/client/roadmapclient/. internal/infrastructure/client/roadmapclient/proto/roadmap.proto

syntax = "proto3";

package roadmapclient;
option go_package = ".;roadmapclient";

import "google/protobuf/timestamp.proto";

message Position {
  double x = 1;
  double y = 2;
}

message NodeData {
  string label = 1;
  string type = 2;
}

message Measured {
  double width = 1;
  double height = 2;
}

message Material {
  string id = 1;
  string name = 2;
  string url = 3;
  string author_id = 4;
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp updated_at = 6;
}

message NodeWithMaterials {
  string id = 1;
  string type = 2;
  string description = 3;
  Position position = 4;
  NodeData data = 5;
  Measured measured = 6;
  bool selected = 7;
  bool dragging = 8;
  repeated Material materials = 9;
}

message Edge {
  string source = 1;
  string target = 2;
  string id = 3;
}

message RoadmapWithMaterials {
  string id = 1;
  repeated NodeWithMaterials nodes = 2;
  repeated Edge edges = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;
}

message CreateRequest {
  string id = 1;
  bool is_public = 2; 
  string author_id = 3;
  repeated NodeWithMaterials nodes = 4;
  repeated Edge edges = 5;
}

message CreateResponse {
  RoadmapWithMaterials roadmap = 1;
  string error = 2;
}

message DeleteRequest {
  string id = 1;
}

message DeleteResponse {
  bool success = 1;
  string error = 2;
}

message GetByIDWithMaterialsRequest {
  string id = 1;
}

message GetByIDWithMaterialsResponse {
  RoadmapWithMaterials roadmap = 1;
  string error = 2;
}

message RegenerateNodeIDsRequest {
  RoadmapWithMaterials roadmap = 1;
}

message RegenerateNodeIDsResponse {
  RoadmapWithMaterials roadmap = 1;
  string error = 2;
}

service RoadmapService {
  rpc Create(CreateRequest) returns (CreateResponse);
  rpc Delete(DeleteRequest) returns (DeleteResponse);
  rpc GetByIDWithMaterials(GetByIDWithMaterialsRequest) returns (GetByIDWithMaterialsResponse);
  rpc RegenerateNodeIDs(RegenerateNodeIDsRequest) returns (RegenerateNodeIDsResponse);
}
